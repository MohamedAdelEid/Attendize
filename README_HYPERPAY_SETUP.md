# إعداد HyperPay للـ Test Mode

## ⚠️ مهم جداً
**لن يعمل النظام بدون إعداد بوابة الدفع بشكل صحيح!** يجب تنفيذ جميع الخطوات التالية.

## المتطلبات من بوابة الدفع HyperPay

للعمل في وضع الاختبار (Test Mode)، تحتاج للحصول على:

1. **Entity ID** - معرف الكيان (من حسابك في HyperPay)
2. **Access Token** - رمز الوصول (من حسابك في HyperPay)
3. **Test URL** - رابط الاختبار: `https://test.oppwa.com/v1` (موجود تلقائياً)

## إعداد الـ Environment Variables

أضف هذه القيم في ملف `.env`:

```env
ENABLE_TEST_PAYMENTS=true
```

## إعداد بوابة الدفع في قاعدة البيانات

### الخطوات:

1. سجل دخول إلى لوحة التحكم
2. اذهب إلى **إعدادات الحساب** (Account Settings)
3. اختر **بوابة الدفع** (Payment Gateway)
4. اختر **HyperPay** من القائمة
5. أدخل البيانات التالية في الحقول:

   - **Access Token**: 
     ```
     OGE4Mjk0MTc2N*******************************
     ```
   
   - **Entity ID (Visa/Mastercard)**: 
     ```
     8a829417***************************
     ```
   
   - **Entity ID (Mada)**: 
     ```
     8ac7a4ca80a5*****************************
     ```
     *(اختياري - إذا كان مختلف عن Visa/Mastercard)*

6. فعّل **Test Mode** ✓
7. اضغط **حفظ** (Save)

⚠️ **بدون هذه البيانات، لن يتم إنشاء جلسة الدفع وستظهر رسالة خطأ!**

## طريقة الدفع المدعومة

- **MADA** - مدى
- **VISA** - فيزا
- **MASTER** - ماستركارد
- **APPLEPAY** - أبل باي

## ملاحظات

- `integrity` hash: هو hash أمان من HyperPay لضمان أن الـ widget لم يتم تعديله
- يتم طلب `integrity` تلقائياً عند إنشاء checkout session
- في Test Mode، يتم استخدام `https://eu-test.oppwa.com/v1`

## حل المشاكل الشائعة

### المشكلة: "بوابة الدفع غير مدعومة للتسجيل أو لم يتم إنشاء جلسة الدفع"
**الحل**: تأكد من:
1. إضافة `ENABLE_TEST_PAYMENTS=true` في ملف `.env`
2. إعداد HyperPay في لوحة التحكم مع Entity ID و Access Token
3. تفعيل Test Mode

### المشكلة: البوب أب لا يظهر
**الحل**: تأكد من أن الـ JavaScript يعمل بشكل صحيح وتحقق من Console في المتصفح